# ğŸ“Š SÆ  Äá»’ TRá»°C QUAN LUá»’NG HOáº T Äá»˜NG

## ğŸ¯ LUá»’NG Tá»”NG QUAN - USER JOURNEY

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER TRUY Cáº¬P WEBSITE                        â”‚
â”‚                    http://localhost:8080/                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   index.html   â”‚
                    â”‚  (Auto redirect)
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  HomeServlet   â”‚
                    â”‚     (GET)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
        â†“                    â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ÄÄƒng nháº­p   â”‚   â”‚  Xem thá»±c Ä‘Æ¡n â”‚   â”‚   Äáº·t bÃ n     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚                   â”‚
        â†“                   â†“                   â†“
   LoginServlet        MenuServlet        ReservationServlet
```

---

## ğŸ” LUá»’NG ÄÄ‚NG NHáº¬P

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User click  â”‚
â”‚ "ÄÄƒng nháº­p"  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LoginServlet (GET)  â”‚
â”‚  â†’ Forward login.jsp â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User nháº­p form     â”‚
â”‚  username/password   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LoginServlet (POST) â”‚
â”‚                      â”‚
â”‚  1. Validate input   â”‚
â”‚  2. AccountDAO.login â”‚
â”‚     â””â”€â†’ SQL Query    â”‚
â”‚  3. Check result     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”
   â”‚       â”‚
   â†“       â†“
â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”
â”‚Successâ”‚â”‚Fail â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”€â”¬â”˜
    â”‚        â”‚
    â”‚        â””â”€â†’ Show error
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Save Account to      â”‚
â”‚ Session              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”
   â”‚       â”‚
   â†“       â†“
â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Admin â”‚ â”‚   Customer   â”‚
â”‚Staff â”‚ â”‚              â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â†“           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚admin/    â”‚ â”‚home  â”‚
â”‚dashboard â”‚ â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›’ LUá»’NG MUA HÃ€NG (E-COMMERCE FLOW)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BÆ¯á»šC 1: XEM THá»°C ÄÆ N                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User â†’ MenuServlet (GET)
         â”‚
         â”œâ”€â†’ CategoryDAO.getAll()
         â”‚   â””â”€â†’ SELECT * FROM Categories
         â”‚
         â”œâ”€â†’ ProductDAO.getAll()
         â”‚   â””â”€â†’ SELECT * FROM Products WHERE is_active=1
         â”‚
         â””â”€â†’ Forward menu.jsp
             â””â”€â†’ Hiá»ƒn thá»‹ danh má»¥c + sáº£n pháº©m


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BÆ¯á»šC 2: THÃŠM MÃ“N VÃ€O GIá» HÃ€NG                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User click "Äáº·t mÃ³n"
    â”‚
    â†“
OrderItemServlet?action=add&productId=123
    â”‚
    â”œâ”€â†’ Láº¥y Session cart (hoáº·c táº¡o má»›i)
    â”‚
    â”œâ”€â†’ ProductDAO.getById(123)
    â”‚   â””â”€â†’ SELECT * FROM Products WHERE id=123
    â”‚
    â”œâ”€â†’ Kiá»ƒm tra product Ä‘Ã£ cÃ³ trong cart?
    â”‚   â”œâ”€â†’ CÃ³: quantity++
    â”‚   â””â”€â†’ ChÆ°a: thÃªm CartItem má»›i
    â”‚
    â””â”€â†’ LÆ°u cart vÃ o Session
        â””â”€â†’ Redirect menu (vá»›i flashSuccess)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BÆ¯á»šC 3: XEM VÃ€ QUáº¢N LÃ GIá» HÃ€NG                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User click "Giá» hÃ ng"
    â”‚
    â†“
CartServlet (GET)
    â”‚
    â”œâ”€â†’ Láº¥y cart tá»« Session
    â”‚
    â”œâ”€â†’ TÃ­nh subtotal = Î£(item.price Ã— item.quantity)
    â”‚
    â”œâ”€â†’ Xá»­ lÃ½ mÃ£ khuyáº¿n mÃ£i (náº¿u cÃ³):
    â”‚   â”œâ”€â†’ PromotionDAO.getByCode(code)
    â”‚   â”‚   â””â”€â†’ SELECT * FROM Promotions WHERE code=? AND is_active=1
    â”‚   â”‚
    â”‚   â””â”€â†’ PromotionDAO.calculateDiscount(promo, subtotal)
    â”‚       â”œâ”€â†’ Percent: discount = subtotal Ã— value / 100
    â”‚       â””â”€â†’ FixedAmount: discount = value
    â”‚
    â”œâ”€â†’ totalAmount = subtotal - discountAmount
    â”‚
    â””â”€â†’ Forward cart.jsp
        â””â”€â†’ Hiá»ƒn thá»‹ danh sÃ¡ch mÃ³n + tá»•ng tiá»n


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BÆ¯á»šC 4: THANH TOÃN                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User click "Thanh toÃ¡n"
    â”‚
    â†“
PaymentServlet (GET)
    â”‚
    â”œâ”€â†’ Check login? (náº¿u chÆ°a â†’ redirect login)
    â”œâ”€â†’ Check cart cÃ³ items? (náº¿u rá»—ng â†’ redirect menu)
    â”‚
    â”œâ”€â†’ TÃ­nh láº¡i subtotal, discountAmount, totalAmount
    â”‚
    â””â”€â†’ Forward payment.jsp
        â””â”€â†’ Hiá»ƒn thá»‹ form thanh toÃ¡n + tÃ³m táº¯t Ä‘Æ¡n


User Ä‘iá»n form â†’ Submit
    â”‚
    â†“
PaymentServlet (POST)
    â”‚
    â”œâ”€â†’ Táº¡o Order object
    â”‚   â”œâ”€â†’ account_id (tá»« Session)
    â”‚   â”œâ”€â†’ promotion_id (tá»« Session)
    â”‚   â”œâ”€â†’ subtotal, discountAmount, totalAmount
    â”‚   â”œâ”€â†’ payment_method, payment_status, order_status
    â”‚   â””â”€â†’ note
    â”‚
    â”œâ”€â†’ OrderDAO.createOrder(order, cartItems)
    â”‚   â”œâ”€â†’ BEGIN TRANSACTION
    â”‚   â”œâ”€â†’ INSERT INTO Orders (...)
    â”‚   â”‚   â””â”€â†’ Láº¥y order_id (auto-generated)
    â”‚   â”‚
    â”‚   â”œâ”€â†’ INSERT INTO OrderDetails (order_id, product_id, quantity, price)
    â”‚   â”‚   â””â”€â†’ Cho má»—i CartItem trong cart
    â”‚   â”‚
    â”‚   â””â”€â†’ COMMIT
    â”‚
    â”œâ”€â†’ Náº¿u thÃ nh cÃ´ng:
    â”‚   â”œâ”€â†’ XÃ³a cart, appliedPromo, discountAmount khá»i Session
    â”‚   â”œâ”€â†’ Set flashSuccess
    â”‚   â””â”€â†’ Redirect order-history
    â”‚
    â””â”€â†’ Náº¿u tháº¥t báº¡i:
        â””â”€â†’ Show error â†’ payment.jsp
```

---

## ğŸ“… LUá»’NG Äáº¶T BÃ€N

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BÆ¯á»šC 1: XEM FORM Äáº¶T BÃ€N                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User click "Äáº·t bÃ n"
    â”‚
    â†“
ReservationServlet (GET)
    â”‚
    â”œâ”€â†’ RestaurantTableDAO.getAll()
    â”‚   â””â”€â†’ SELECT * FROM RestaurantTables ORDER BY name
    â”‚
    â””â”€â†’ Forward reservation.jsp
        â””â”€â†’ Hiá»ƒn thá»‹ form vá»›i dropdown chá»n bÃ n


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BÆ¯á»šC 2: Gá»¬I YÃŠU Cáº¦U Äáº¶T BÃ€N                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Ä‘iá»n form â†’ Submit
    â”‚
    â†“
ReservationServlet (POST)
    â”‚
    â”œâ”€â†’ Validate input
    â”‚   â”œâ”€â†’ customerName, phone (required)
    â”‚   â”œâ”€â†’ bookingDate, bookingTime (required)
    â”‚   â””â”€â†’ numPeople (required)
    â”‚
    â”œâ”€â†’ Táº¡o Booking object
    â”‚   â”œâ”€â†’ customer_name, phone
    â”‚   â”œâ”€â†’ booking_date, booking_time
    â”‚   â”œâ”€â†’ num_people, note
    â”‚   â””â”€â†’ status = "Pending"
    â”‚
    â”œâ”€â†’ BookingDAO.createBooking(booking, tableIds)
    â”‚   â”œâ”€â†’ BEGIN TRANSACTION
    â”‚   â”‚
    â”‚   â”œâ”€â†’ INSERT INTO Bookings (customer_name, phone, ...)
    â”‚   â”‚   â””â”€â†’ Láº¥y booking_id (auto-generated)
    â”‚   â”‚
    â”‚   â”œâ”€â†’ INSERT INTO BookingTables (booking_id, table_id)
    â”‚   â”‚   â””â”€â†’ Cho má»—i bÃ n Ä‘Æ°á»£c chá»n
    â”‚   â”‚
    â”‚   â”œâ”€â†’ UPDATE RestaurantTables SET status='Reserved'
    â”‚   â”‚   â””â”€â†’ WHERE id IN (tableIds)
    â”‚   â”‚
    â”‚   â””â”€â†’ COMMIT
    â”‚
    â”œâ”€â†’ Náº¿u thÃ nh cÃ´ng:
    â”‚   â””â”€â†’ Show successMessage â†’ reservation.jsp
    â”‚
    â””â”€â†’ Náº¿u tháº¥t báº¡i:
        â””â”€â†’ Show error â†’ reservation.jsp
```

---

## ğŸ“œ LUá»’NG XEM Lá»ŠCH Sá»¬ ÄÆ N HÃ€NG

```
User click "Lá»‹ch sá»­ Ä‘Æ¡n hÃ ng"
    â”‚
    â†“
OrderHistoryServlet (GET)
    â”‚
    â”œâ”€â†’ Check login? (náº¿u chÆ°a â†’ redirect login)
    â”‚
    â”œâ”€â†’ Láº¥y Account tá»« Session
    â”‚
    â”œâ”€â†’ OrderDAO.getByAccountId(accountId)
    â”‚   â”œâ”€â†’ SELECT o.*, a.full_name FROM Orders o
    â”‚   â”‚   LEFT JOIN Accounts a ON o.account_id = a.id
    â”‚   â”‚   WHERE o.account_id = ?
    â”‚   â”‚   ORDER BY o.created_at DESC
    â”‚   â”‚
    â”‚   â””â”€â†’ Vá»›i má»—i Order:
    â”‚       â””â”€â†’ OrderDAO.getOrderDetails(orderId)
    â”‚           â””â”€â†’ SELECT od.*, p.name, p.image_url
    â”‚               FROM OrderDetails od
    â”‚               INNER JOIN Products p ON od.product_id = p.id
    â”‚               WHERE od.order_id = ?
    â”‚
    â””â”€â†’ Forward order-history.jsp
        â””â”€â†’ Hiá»ƒn thá»‹ danh sÃ¡ch Ä‘Æ¡n hÃ ng vá»›i chi tiáº¿t
```

---

## ğŸ”„ KIáº¾N TRÃšC Tá»”NG QUAN

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENT LAYER                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚home.jsp  â”‚  â”‚menu.jsp  â”‚  â”‚cart.jsp  â”‚  â”‚payment.jspâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚             â”‚             â”‚             â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CONTROLLER LAYER                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚HomeServlet   â”‚  â”‚MenuServlet   â”‚  â”‚CartServlet   â”‚  ...  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚               â”‚                   â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚               â”‚                   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DAO LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚CategoryDAO   â”‚  â”‚ProductDAO    â”‚  â”‚OrderDAO      â”‚  ...  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                 â”‚                 â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                 â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATABASE LAYER                           â”‚
â”‚              SQL Server - QLNhaHang Database                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚Accounts  â”‚  â”‚Products  â”‚  â”‚Orders    â”‚  â”‚Bookings  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ SESSION MANAGEMENT

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SESSION STORAGE                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Session Ä‘Æ°á»£c táº¡o khi:
  - User Ä‘Äƒng nháº­p thÃ nh cÃ´ng

Session chá»©a:
  â”œâ”€â†’ account (Account object)
  â”‚   â””â”€â†’ LÆ°u sau khi LoginServlet xÃ¡c thá»±c thÃ nh cÃ´ng
  â”‚
  â”œâ”€â†’ cart (List<CartItem>)
  â”‚   â””â”€â†’ ÄÆ°á»£c táº¡o khi OrderItemServlet thÃªm mÃ³n Ä‘áº§u tiÃªn
  â”‚   â””â”€â†’ ÄÆ°á»£c xÃ³a sau khi PaymentServlet táº¡o Order thÃ nh cÃ´ng
  â”‚
  â”œâ”€â†’ appliedPromo (Promotion object)
  â”‚   â””â”€â†’ LÆ°u khi CartServlet Ã¡p dá»¥ng mÃ£ KM thÃ nh cÃ´ng
  â”‚   â””â”€â†’ ÄÆ°á»£c xÃ³a sau khi PaymentServlet táº¡o Order
  â”‚
  â”œâ”€â†’ discountAmount (Double)
  â”‚   â””â”€â†’ TÃ­nh toÃ¡n tá»« PromotionDAO.calculateDiscount()
  â”‚
  â””â”€â†’ flashSuccess, flashError (String)
      â””â”€â†’ ThÃ´ng bÃ¡o táº¡m thá»i, tá»± xÃ³a sau khi hiá»ƒn thá»‹
```

---

## ğŸ” SECURITY FLOW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CHARACTER ENCODING FILTER                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Má»i request Ä‘á»u Ä‘i qua CharacterEncodingFilter:
  â”œâ”€â†’ Set request encoding: UTF-8
  â”œâ”€â†’ Set response encoding: UTF-8
  â””â”€â†’ Set content type: text/html; charset=UTF-8


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AUTHENTICATION CHECK                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CÃ¡c trang yÃªu cáº§u Ä‘Äƒng nháº­p:
  â”œâ”€â†’ PaymentServlet
  â”œâ”€â†’ OrderHistoryServlet
  â”‚
  â””â”€â†’ Logic check:
      if (session.getAttribute("account") == null) {
          redirect("login");
      }
```

---

## ğŸ“ GHI CHÃš QUAN TRá»ŒNG

1. **Transaction Management:**
   - OrderDAO.createOrder() vÃ  BookingDAO.createBooking() sá»­ dá»¥ng transaction
   - Náº¿u cÃ³ lá»—i â†’ rollback toÃ n bá»™
   - Äáº£m báº£o tÃ­nh toÃ n váº¹n dá»¯ liá»‡u

2. **Error Handling:**
   - Táº¥t cáº£ exception Ä‘Æ°á»£c catch vÃ  log
   - Hiá»ƒn thá»‹ error message thÃ¢n thiá»‡n cho user
   - KhÃ´ng expose thÃ´ng tin lá»—i ká»¹ thuáº­t

3. **Data Flow:**
   - Request â†’ Servlet â†’ DAO â†’ Database
   - Response â† Servlet â† DAO â† Database
   - Data Ä‘Æ°á»£c map tá»« ResultSet â†’ Model objects

4. **State Management:**
   - Cart Ä‘Æ°á»£c lÆ°u trong Session (khÃ´ng lÆ°u DB cho Ä‘áº¿n khi checkout)
   - User session Ä‘Æ°á»£c quáº£n lÃ½ bá»Ÿi container (Tomcat)



